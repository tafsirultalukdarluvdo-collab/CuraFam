<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>প্রশ্ন ও উত্তর - CuraFam</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <nav class="navbar">
            <div class="nav-container">
                <div class="nav-logo">
                    <a href="index.html" style="color: white; text-decoration: none; display: flex; align-items: center;">
                        <img src="logo.png.png" alt="CuraFam" style="height: 40px; margin-right: 10px;">
                        <h2>CuraFam</h2>
                    </a>
                </div>
                
                <ul class="nav-menu">
                    <li class="nav-item"><a href="index.html" class="nav-link">হোম</a></li>
                    <li class="nav-item"><a href="ask-question.html" class="nav-link">প্রশ্ন করুন</a></li>
                    <li class="nav-item"><a href="doctor-portal.html" class="nav-link">ডাক্তার পোর্টাল</a></li>
                    <li class="nav-item"><a href="emergency.html" class="nav-link">জরুরি সেবা</a></li>
                </ul>

                <div class="hamburger" onclick="toggleMobileMenu()">
                    <span class="bar"></span>
                    <span class="bar"></span>
                    <span class="bar"></span>
                </div>
            </div>
        </nav>
    </header>

    <main>
        <div class="container" style="margin-top: 100px;">
            <h1>প্রশ্ন ও উত্তর</h1>
            <p>আমাদের বিশেষজ্ঞ ডাক্তারদের চিকিৎসা পরামর্শ দেখুন</p>

            <div class="qa-filters">
                <input type="text" class="search-box" id="searchBox" 
                       placeholder="প্রশ্ন খুঁজুন..." onkeyup="filterQuestions()">
                
                <button class="filter-btn active" onclick="filterByType('all')">সব</button>
                <button class="filter-btn" onclick="filterByType('human')">মানুষের স্বাস্থ্য</button>
                <button class="filter-btn" onclick="filterByType('animal')">পশুর স্বাস্থ্য</button>
                <button class="filter-btn" onclick="filterByStatus('answered')">উত্তর দেওয়া</button>
                <button class="filter-btn" onclick="filterByStatus('pending')">অপেক্ষমাণ</button>
            </div>

            <div id="questionsContainer"></div>

            <div id="noQuestionsMessage" style="display: none; text-align: center; padding: 3rem;">
                <h3>কোন প্রশ্ন পাওয়া যায়নি</h3>
                <p>আপনার অনুসন্ধানের সাথে কোন প্রশ্ন মিলেনি।</p>
                <a href="ask-question.html" class="btn btn-primary">নতুন প্রশ্ন করুন</a>
            </div>

            <div id="loadingMessage" style="text-align: center; padding: 2rem;">
                <div class="loading"></div>
                <p>প্রশ্ন লোড হচ্ছে...</p>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>CuraFam</h3>
                    <p>আপনার পরিবারের স্বাস্থ্য সেবা</p>
                </div>
                <div class="footer-section">
                    <h4>দ্রুত লিংক</h4>
                    <ul>
                        <li><a href="index.html">হোম</a></li>
                        <li><a href="ask-question.html">প্রশ্ন করুন</a></li>
                        <li><a href="doctor-portal.html">ডাক্তার পোর্টাল</a></li>
                        <li><a href="emergency.html">জরুরি সেবা</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 CuraFam. All rights reserved.</p>
                <p>This website is created by Tafsirul Talukdar</p>
            </div>
        </div>
    </footer>

    <script>
        let allQuestions = [];
        let currentFilter = { type: 'all', status: 'all' };
        const API_BASE = 'https://curafam.onrender.com';

        document.addEventListener('DOMContentLoaded', function() {
            loadQuestions();
        });

        function toggleMobileMenu() {
            const navMenu = document.querySelector('.nav-menu');
            const hamburger = document.querySelector('.hamburger');
            
            navMenu.classList.toggle('active');
            hamburger.classList.toggle('active');
        }

        async function loadQuestions() {
            document.getElementById('loadingMessage').style.display = 'block';
            
            try {
                const response = await fetch(`${API_BASE}/api/questions`);
                if (response.ok) {
                    allQuestions = await response.json();
                    displayQuestions(allQuestions);
                } else {
                    console.error('Failed to load questions');
                    allQuestions = [];
                    displayQuestions([]);
                }
            } catch (error) {
                console.error('Error loading questions:', error);
                allQuestions = [];
                displayQuestions([]);
            } finally {
                document.getElementById('loadingMessage').style.display = 'none';
            }
        }

        function displayQuestions(questions) {
            const container = document.getElementById('questionsContainer');
            const noQuestionsMsg = document.getElementById('noQuestionsMessage');
            
            if (questions.length === 0) {
                container.innerHTML = '';
                noQuestionsMsg.style.display = 'block';
                return;
            }
            
            noQuestionsMsg.style.display = 'none';
            
            const sortedQuestions = questions.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            container.innerHTML = sortedQuestions.map(question => createQuestionCard(question)).join('');
        }

        function createQuestionCard(question) {
            const typeText = question.type === 'human' ? 'মানুষের স্বাস্থ্য' : 'পশুর স্বাস্থ্য';
            const typeClass = question.type === 'human' ? 'human' : 'animal';
            
            return `
                <div class="question-card">
                    <div class="question-header">
                        <span class="question-type ${typeClass}">${typeText}</span>
                        <span class="question-date">${formatDate(question.createdAt)}</span>
                    </div>
                    
                    <h3 class="question-title">${escapeHtml(question.title)}</h3>
                    <p><strong>রোগী:</strong> ${escapeHtml(question.patientName)}${question.age ? `, ${question.age}` : ''}</p>
                    <div class="question-content">${escapeHtml(question.description)}</div>
                    
                    ${question.answer ? `
                        <div class="answer-section">
                            <div class="answer-header">
                                <span class="doctor-name">ডাঃ ${escapeHtml(question.answeredBy || 'বিশেষজ্ঞ ডাক্তার')}</span>
                                <span class="answer-date">${formatDate(question.answeredAt || question.createdAt)}</span>
                            </div>
                            <div class="answer-content">${escapeHtml(question.answer)}</div>
                        </div>
                    ` : `
                        <div class="no-answer">
                            এই প্রশ্নের এখনো উত্তর দেওয়া হয়নি। শীঘ্রই ডাক্তারদের কাছ থেকে উত্তর পাবেন।
                        </div>
                    `}
                </div>
            `;
        }

        function filterByType(type) {
            currentFilter.type = type;
            updateActiveButton(event.target);
            applyFilters();
        }

        function filterByStatus(status) {
            currentFilter.status = status;
            updateActiveButton(event.target);
            applyFilters();
        }

        function updateActiveButton(clickedButton) {
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            clickedButton.classList.add('active');
        }

        function applyFilters() {
            let filteredQuestions = allQuestions;
            
            if (currentFilter.type !== 'all') {
                filteredQuestions = filteredQuestions.filter(q => q.type === currentFilter.type);
            }
            
            if (currentFilter.status === 'answered') {
                filteredQuestions = filteredQuestions.filter(q => q.answer);
            } else if (currentFilter.status === 'pending') {
                filteredQuestions = filteredQuestions.filter(q => !q.answer);
            }
            
            const searchTerm = document.getElementById('searchBox').value.toLowerCase();
            if (searchTerm) {
                filteredQuestions = filteredQuestions.filter(q => 
                    q.title.toLowerCase().includes(searchTerm) ||
                    q.description.toLowerCase().includes(searchTerm) ||
                    q.patientName.toLowerCase().includes(searchTerm) ||
                    (q.answer && q.answer.toLowerCase().includes(searchTerm))
                );
            }
            
            displayQuestions(filteredQuestions);
        }

        function filterQuestions() {
            applyFilters();
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffTime = Math.abs(now - date);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays === 1) {
                return 'আজ';
            } else if (diffDays === 2) {
                return 'গতকাল';
            } else if (diffDays <= 7) {
                return `${diffDays - 1} দিন আগে`;
            } else {
                return date.toLocaleDateString('bn-BD');
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Auto refresh every 30 seconds
        setInterval(() => {
            loadQuestions();
        }, 30000);
    </script>
    <script src="script.js"></script>
</body>
</html>
