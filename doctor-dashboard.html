<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶°‡¶æ‡¶ï‡ßç‡¶§‡¶æ‡¶∞ ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶° - CuraFam</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            line-height: 1.6; 
            color: #2c3e50;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 0 1rem; 
        }
        
        header { 
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            color: #2c3e50; 
            padding: 1rem 0; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        header .container { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }
        
        .logo h1 { 
            font-size: 2rem;
            background: linear-gradient(135deg, #2E8B57, #20B2AA);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .logo p {
            color: #667eea;
            font-weight: 600;
        }
        
        .btn { 
            display: inline-block; 
            padding: 0.8rem 1.5rem; 
            background: linear-gradient(135deg, #2E8B57, #20B2AA);
            color: white; 
            text-decoration: none; 
            border-radius: 25px;
            transition: all 0.3s; 
            border: none; 
            cursor: pointer;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(46, 139, 87, 0.3);
        }
        
        .btn:hover { 
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(46, 139, 87, 0.4);
        }
        
        .btn-secondary { 
            background: linear-gradient(135deg, #667eea, #764ba2);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .btn-secondary:hover {
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
        
        .btn-danger { 
            background: linear-gradient(135deg, #f093fb, #f5576c);
            box-shadow: 0 4px 15px rgba(245, 87, 108, 0.3);
        }
        
        .btn-danger:hover {
            box-shadow: 0 6px 20px rgba(245, 87, 108, 0.4);
        }
        
        .dashboard { 
            padding: 2rem 0; 
        }
        
        .stats-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
            gap: 1.5rem; 
            margin-bottom: 2rem; 
        }
        
        .stat-card { 
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 2rem; 
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.15);
        }
        
        .stat-number { 
            font-size: 2.5rem; 
            font-weight: bold;
            background: linear-gradient(135deg, #2E8B57, #20B2AA);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .qa-card { 
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            margin-bottom: 1.5rem;
            border-left: 5px solid #2E8B57;
            transition: all 0.3s;
        }
        
        .qa-card:hover {
            transform: translateX(5px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.15);
        }
        
        .question-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: flex-start; 
            margin-bottom: 1rem; 
        }
        
        .question-header h3 {
            color: #2c3e50;
            font-size: 1.3rem;
        }
        
        .question-type { 
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .question-type.human { 
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .question-type.animal { 
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
        }
        
        .form-group { 
            margin-bottom: 1rem; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #2c3e50;
            font-weight: 600;
        }
        
        .form-group textarea { 
            width: 100%; 
            padding: 1rem;
            border: 2px solid rgba(102, 126, 234, 0.3);
            border-radius: 15px;
            min-height: 120px;
            font-family: inherit;
            transition: all 0.3s;
            background: rgba(255, 255, 255, 0.9);
        }
        
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .no-questions { 
            text-align: center; 
            padding: 4rem 2rem;
            color: #2c3e50;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .login-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 2rem;
            border-radius: 20px;
            margin-bottom: 2rem;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .login-card h3 {
            color: #2c3e50;
            margin-bottom: 1rem;
        }
        
        .login-card input {
            flex: 1;
            padding: 1rem;
            border: 2px solid rgba(102, 126, 234, 0.3);
            border-radius: 15px;
            font-size: 1rem;
            transition: all 0.3s;
            background: rgba(255, 255, 255, 0.9);
        }
        
        .login-card input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        #welcomeMessage {
            color: white;
            text-shadow: 0 2px 10px rgba(0,0,0,0.2);
            margin-bottom: 2rem;
            font-size: 2rem;
        }
        
        h3 {
            color: white;
            text-shadow: 0 2px 10px rgba(0,0,0,0.2);
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="logo">
                <h1><i class="fas fa-heartbeat"></i> CuraFam</h1>
                <p>‡¶°‡¶æ‡¶ï‡ßç‡¶§‡¶æ‡¶∞ ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°</p>
            </div>
            <nav>
                <a href="index.html" class="btn btn-secondary">‡¶π‡ßã‡¶Æ</a>
                <a href="doctor-portal.html" class="btn">‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶®</a>
            </nav>
        </div>
    </header>

    <main class="dashboard">
        <div class="container">
            <div class="login-card">
                <h3>‡¶°‡¶æ‡¶ï‡ßç‡¶§‡¶æ‡¶∞ ‡¶≤‡¶ó‡¶á‡¶®</h3>
                <div style="display: flex; gap: 1rem; align-items: center; margin-top: 1rem;">
                    <input type="text" id="doctorIdInput" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ID">
                    <button class="btn" onclick="loginDoctor()">‡¶≤‡¶ó‡¶á‡¶®</button>
                    <button class="btn btn-danger" onclick="logoutDoctor()">‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</button>
                </div>
                <div id="loginStatus" style="margin-top: 1rem; font-weight: bold;"></div>
            </div>
            
            <div id="dashboardContent" style="display: none;">
                <h2 id="welcomeMessage">‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ, ‡¶°‡¶æ‡¶ï‡ßç‡¶§‡¶æ‡¶∞!</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalQuestions">0</div>
                    <p>‡¶Æ‡ßã‡¶ü ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®</p>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="answeredQuestions">0</div>
                    <p>‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®</p>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="pendingQuestions">0</div>
                    <p>‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶Æ‡¶æ‡¶£ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®</p>
                </div>
                <div class="stat-card" onclick="showNotifications()" style="cursor: pointer; border: 2px solid #20B2AA;">
                    <div class="stat-number" id="newNotifications" style="color: #dc2626;">0</div>
                    <p>üîî ‡¶®‡¶§‡ßÅ‡¶® ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶®</p>
                </div>
            </div>

            <div id="notificationPanel" style="display: none; background: white; padding: 1.5rem; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 2rem;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h3>üîî ‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡ßá‡¶∞ ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶®</h3>
                    <button class="btn btn-secondary" onclick="hideNotifications()">‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </div>
                <div id="notificationsList"></div>
            </div>

            <h3>‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶Æ‡¶æ‡¶£ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡¶∏‡¶Æ‡ßÇ‡¶π</h3>
            <div id="questionsContainer">
                <div class="no-questions">
                    <i class="fas fa-comments" style="font-size: 3rem; color: #20B2AA; margin-bottom: 1rem;"></i>
                    <h3>‡¶ï‡ßã‡¶® ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶®‡ßá‡¶á</h3>
                    <p>‡¶è‡¶ñ‡¶®‡ßã ‡¶ï‡ßã‡¶® ‡¶∞‡ßã‡¶ó‡ßÄ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶ï‡¶∞‡ßá‡¶®‡¶ø‡•§</p>
                </div>
            </div>
            </div>
        </div>
    </main>

    <script>
        const API_BASE = 'https://curafam.onrender.com';
        
        class LocalDatabase {
            getQuestions() {
                return JSON.parse(localStorage.getItem('curafam_questions') || '[]');
            }
            getDoctors() {
                return JSON.parse(localStorage.getItem('curafam_doctors') || '[]');
            }
            getNotifications() {
                return JSON.parse(localStorage.getItem('curafam_notifications') || '[]');
            }
            markNotificationRead(notificationId) {
                const notifications = this.getNotifications();
                const notification = notifications.find(n => n.id === notificationId);
                if (notification) {
                    notification.read = true;
                    localStorage.setItem('curafam_notifications', JSON.stringify(notifications));
                }
            }
            updateQuestion(questionId, answer, doctorId) {
                const doctors = this.getDoctors();
                const doctor = doctors.find(d => d.id === doctorId);
                if (!doctor) {
                    return { success: false, error: '‡¶Ö‡¶¨‡ßà‡¶ß ‡¶°‡¶æ‡¶ï‡ßç‡¶§‡¶æ‡¶∞ ID' };
                }
                
                const questions = this.getQuestions();
                const questionIndex = questions.findIndex(q => q.id === questionId);
                if (questionIndex !== -1) {
                    questions[questionIndex].answer = answer;
                    questions[questionIndex].answeredAt = new Date().toISOString();
                    questions[questionIndex].answeredBy = doctor.name;
                    questions[questionIndex].doctorId = doctorId;
                    localStorage.setItem('curafam_questions', JSON.stringify(questions));
                    return { success: true };
                }
                return { success: false, error: '‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø' };
            }
        }

        const localDB = new LocalDatabase();

        async function loadDashboard() {
            console.log('Loading dashboard...');
            try {
                // Fetch questions from MongoDB server
                console.log('Fetching from:', `${API_BASE}/api/questions`);
                const response = await fetch(`${API_BASE}/api/questions`);
                if (!response.ok) {
                    throw new Error('Failed to fetch questions');
                }
                const questions = await response.json();
                console.log('Questions fetched:', questions.length, questions);
                
                const answered = questions.filter(q => q.answer);
                const pending = questions.filter(q => !q.answer);
                console.log('Pending questions:', pending.length);
                console.log('Answered questions:', answered.length);
                
                const notifications = localDB.getNotifications();
                const unreadNotifications = notifications.filter(n => !n.read);

                document.getElementById('totalQuestions').textContent = questions.length;
                document.getElementById('answeredQuestions').textContent = answered.length;
                document.getElementById('pendingQuestions').textContent = pending.length;
                document.getElementById('newNotifications').textContent = unreadNotifications.length;

                const container = document.getElementById('questionsContainer');
                console.log('Questions container found:', container !== null);
                if (pending.length === 0) {
                    console.log('No pending questions found');
                    container.innerHTML = `
                        <div class="no-questions">
                            <i class="fas fa-comments" style="font-size: 3rem; color: #20B2AA; margin-bottom: 1rem;"></i>
                            <h3>‡¶ï‡ßã‡¶® ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶®‡ßá‡¶á</h3>
                            <p>‡¶∏‡¶¨ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡ßá‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡ßá ‡¶ó‡ßá‡¶õ‡ßá!</p>
                        </div>
                    `;
                    return;
                }
                
                console.log('Rendering', pending.length, 'pending questions');

                container.innerHTML = pending.map(q => `
                    <div class="qa-card">
                        <div class="question-header">
                            <h3>${q.title}</h3>
                            <span class="question-type ${q.type}">${q.type === 'human' ? '‡¶Æ‡¶æ‡¶®‡ßÅ‡¶∑' : '‡¶™‡¶∂‡ßÅ'}</span>
                        </div>
                        <p><strong>‡¶∞‡ßã‡¶ó‡ßÄ‡¶∞ ‡¶®‡¶æ‡¶Æ:</strong> ${q.patientName || '‡¶â‡¶≤‡ßç‡¶≤‡ßá‡¶ñ ‡¶®‡ßá‡¶á'}</p>
                        <p><strong>‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®:</strong> ${q.description}</p>
                        <p><strong>‡¶¨‡¶Ø‡¶º‡¶∏:</strong> ${q.age || '‡¶â‡¶≤‡ßç‡¶≤‡ßá‡¶ñ ‡¶®‡ßá‡¶á'}</p>
                        <p><strong>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ:</strong> ${new Date(q.createdAt).toLocaleDateString('bn-BD')}</p>
                        
                        <div class="form-group">
                            <label>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡¶∞:</label>
                            <textarea id="answer_${q._id}" placeholder="‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..."></textarea>
                        </div>
                        <button class="btn" onclick="submitAnswer('${q._id}')">‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®</button>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading dashboard:', error);
                alert('Error: ' + error.message + '\n\nCheck browser console (F12) for details.');
                document.getElementById('questionsContainer').innerHTML = `
                    <div class="no-questions">
                        <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: #dc2626; margin-bottom: 1rem;"></i>
                        <h3>‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø</h3>
                        <p>‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ${error.message}</p>
                        <p>Browser console (F12) check ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>
                    </div>
                `;
            }
        }

        async function loginDoctor() {
            const doctorId = document.getElementById('doctorIdInput').value.trim();
            if (!doctorId) {
                alert('‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ID ‡¶¶‡¶ø‡¶®');
                return;
            }
            
            try {
                // Fetch doctors from MongoDB
                const response = await fetch(`${API_BASE}/api/doctors`);
                if (!response.ok) {
                    throw new Error('Failed to fetch doctors');
                }
                const doctors = await response.json();
                const doctor = doctors.find(d => d._id === doctorId);
                
                if (doctor) {
                    localStorage.setItem('curafam_logged_doctor', doctorId);
                    localStorage.setItem('curafam_doctor_name', doctor.name);
                    document.getElementById('loginStatus').innerHTML = `<span style="color: green;">‚úì ‡¶≤‡¶ó‡¶á‡¶® ‡¶∏‡¶´‡¶≤: ${doctor.name}</span>`;
                    document.getElementById('welcomeMessage').textContent = `‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ, ‡¶°‡¶æ. ${doctor.name}!`;
                    document.getElementById('dashboardContent').style.display = 'block';
                    loadDashboard();
                } else {
                    alert('‡¶Ö‡¶¨‡ßà‡¶ß ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ID');
                }
            } catch (error) {
                console.error('Login error:', error);
                alert('‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§');
            }
        }
        
        function logoutDoctor() {
            localStorage.removeItem('curafam_logged_doctor');
            document.getElementById('loginStatus').innerHTML = '<span style="color: red;">‚úó ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá</span>';
            document.getElementById('dashboardContent').style.display = 'none';
            document.getElementById('doctorIdInput').value = '';
        }

        async function submitAnswer(questionId) {
            const loggedDoctorId = localStorage.getItem('curafam_logged_doctor');
            if (!loggedDoctorId) {
                alert('‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®');
                return;
            }
            
            const answerText = document.getElementById(`answer_${questionId}`).value.trim();
            if (!answerText) {
                alert('‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®‡•§');
                return;
            }

            try {
                // Get doctor name from localStorage
                const doctorName = localStorage.getItem('curafam_doctor_name') || 'Anonymous Doctor';
                
                // Submit answer to MongoDB server
                const response = await fetch(`${API_BASE}/api/questions/${questionId}/answer`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        answer: answerText,
                        answeredBy: doctorName
                    })
                });
                
                if (response.ok) {
                    alert('‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ú‡¶Æ‡¶æ ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
                    loadDashboard();
                } else {
                    const errorData = await response.json().catch(() => ({}));
                    alert('‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ' + (errorData.error || 'Server error'));
                }
            } catch (error) {
                console.error('Error submitting answer:', error);
                alert('‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
            }
        }

        function showNotifications() {
            const notifications = localDB.getNotifications();
            const panel = document.getElementById('notificationPanel');
            const list = document.getElementById('notificationsList');
            
            if (notifications.length === 0) {
                list.innerHTML = '<p style="text-align: center; color: #666;">‡¶ï‡ßã‡¶® ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶®‡ßá‡¶á</p>';
            } else {
                list.innerHTML = notifications.map(n => `
                    <div style="padding: 1rem; border: 1px solid #e5e7eb; border-radius: 8px; margin-bottom: 0.5rem; ${n.read ? 'opacity: 0.6;' : 'background: #f0f9ff;'}">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h4 style="color: #2E8B57; margin: 0;">${n.title}</h4>
                                <p style="margin: 0.5rem 0; color: #666;">‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® (${n.type === 'human' ? '‡¶Æ‡¶æ‡¶®‡ßÅ‡¶∑' : '‡¶™‡¶∂‡ßÅ'})</p>
                                <small style="color: #888;">${new Date(n.createdAt).toLocaleString('bn-BD')}</small>
                            </div>
                            <button class="btn" onclick="markAsRead('${n.id}')" ${n.read ? 'disabled' : ''}>
                                ${n.read ? '‡¶™‡ßú‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá' : '‡¶™‡ßú‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®'}
                            </button>
                        </div>
                    </div>
                `).join('');
            }
            
            panel.style.display = 'block';
        }
        
        function hideNotifications() {
            document.getElementById('notificationPanel').style.display = 'none';
        }
        
        function markAsRead(notificationId) {
            localDB.markNotificationRead(notificationId);
            loadDashboard();
            showNotifications();
        }

        document.addEventListener('DOMContentLoaded', async function() {
            const loggedDoctorId = localStorage.getItem('curafam_logged_doctor');
            if (loggedDoctorId) {
                try {
                    // Fetch doctors from MongoDB
                    const response = await fetch(`${API_BASE}/api/doctors`);
                    if (response.ok) {
                        const doctors = await response.json();
                        const doctor = doctors.find(d => d._id === loggedDoctorId);
                        if (doctor) {
                            localStorage.setItem('curafam_doctor_name', doctor.name);
                            document.getElementById('doctorIdInput').value = loggedDoctorId;
                            document.getElementById('loginStatus').innerHTML = `<span style="color: green;">‚úì ‡¶≤‡¶ó‡¶á‡¶® ‡¶∏‡¶´‡¶≤: ${doctor.name}</span>`;
                            document.getElementById('welcomeMessage').textContent = `‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ, ‡¶°‡¶æ. ${doctor.name}!`;
                            document.getElementById('dashboardContent').style.display = 'block';
                            loadDashboard();
                        }
                    }
                } catch (error) {
                    console.error('Error loading doctor session:', error);
                }
            }
        });
    </script>
</body>
</html>